# Recommended for General Interchange

[書記素判定](grapheme-breaking.md)で「絵文字シーケンスになりうる」と判定される文字列の中で、
「最低限どの環境でもこのシーケンスに対応することを推奨する」ということになっているものを
RGI (Recommended for General Interchange) っていう。

Unicode 上、以下の2つのファイルで一覧定義されてる。

- [emoji-sequences](https://www.unicode.org/Public/emoji/13.1/emoji-sequences.txt)
- [emoji-zwj-sequences](https://www.unicode.org/Public/emoji/13.1/emoji-zwj-sequences.txt)

いくつかの種類に分かれてて、
書記素分割するにしても、テーブル化するにしても種類ごとに分けて考えた方が楽。

## Basic_Emoji

1符号点で単独で RGI なものと、
1符号点 + U+FE0F (異体字セレクター16)なものは Basic_Emoji という名前で分類されてる。

### 異体字セレクター16

一部の文字は「U+FE0F が付いているときだけカラー画像(emoji style)で表示する」と言うことになってるものの、
実際のところ U+FE0F が付いていようと付いていまいと無条件でカラー画像表示する環境も多い。

text/emoji style の表示切替はフォント次第なところもあって、同じOS、同じアプリ内ですら「`input` タグ内だと text style になるけど、`p` タグないだと emoji style になる」みたいなのもあって正直「U+FE0F の有無」はまともに判別されてないと思っておいた方がいい。

一例として、Twitter は一部の文字だけ特別扱いしてそう。
2021年上半期時点で、「U+FE0F が付いてるときだけカラー画像表示」をしている文字は

- © (U+00A9, copyright)
- ® (U+00AE, registered)
- ™ (U+2122, trademark)
- ♟ (U+265F, チェスの黒のポーン)

の4つだけっぽい雰囲気。

ポーンだけ特殊扱いというのも変な話だけど…

- 元々、白黒の記号として ♕♖♗♘♙♚♛♜♝♞♟ (U+2654～265F) があった
- キャリア絵文字的にも別にこれと統合された絵文字はない
- 後々、色々なおもちゃを表す絵文字を追加することになった(🧩 (ジグソーパズル)とか)
- その際に、チェスを表す絵文字は黒ポーンに異体字セレクター16を付けて表す仕様になった

という後付け仕様のせいみたい。

## Keycap

電話の「1, 2, ..., *, #」ボタンみたいなのを「四角で囲んだ1」みたいなグリフで表すやつ。

ASCII 文字、U+FE0F、U+20E3 という3文字のシーケンスになってる。
以下の2つの意味で特殊なので、別判定した方が楽になる。

- 絵文字シーケンスの中で唯一 ASCII 文字を含む
- 唯一、Extend の部分に異体字セレクターと肌色選択以外の文字(U+20E3、Combining Enclosing Keycap)を含む

12文字。ほんとにこの12文字だけ構造が浮いてるので、今後増えることはないと思う。

## RGI_Emoji_Flag_Sequence (Regional Indicator 国旗)

ISO 3166-1 (ラテン文字2文字で国または地域を表す規格)に沿って国旗を表示しようとしてしまったがために生まれた仕様。

U+1F1E6～1F1FF に A～Z に相当する文字が入ってて、これを Regional Indicator と呼ぶ。
国旗はこの Regional Indicator 2文字で表現(US でアメリカ、JP で日本みたいな)。
これは以下の2つの意味で特殊。

- ZWJ なしで2文字くっつく
- 2文字の時だけ絵文字シーケンス判定を受ける(偶数個並ぶのはいいけど奇数個並んでるのは不正)

258文字。
「国または地域コード」の規格に頼っているので増減が起こりえるとしたら新国家樹立みたいな時だけ。
Unicode コンソーシアムとしてはそういう地政学に巻き込まれたくはなさそうだし、
今後は後述する Tag Sequence という別仕様があってそちらを使うと思うので、
たぶん Regional Indicator 国旗の増減はないと思う。

## RGI_Emoji_Tag_Sequence (Tag 国旗)

ISO 3166-1 で旗を表したら、それに含まれていない地域から怒られた結果増えた仕様。
ISO 3166-2 (ラテン文字4～5文字で表現する行政区画コード)に基づいて旗を出す。

🏴 (U+1F3F4、黒旗)の後ろに「タグ文字」っていう特殊な記号を並べる仕様。
タグ文字は U+E0000 の辺りに並んでる(E0000 引いた結果の ASCII 文字に対応)。

将来「地域の旗」以外の用途でも使うかもしれないので「tag sequence」って名前になってる。
一応原理上は「東京都の旗」(🏴JP13)とかも出せる。
Unicode 13.1 時点で RGI に入ってるのはグレートブリテン島の3カントリーだけ(というかこのカントリー旗のためにこの仕様が入った)。

サッカーのナショナルチームがイングランド、スコットランド、ウェールズに分かれてるせいでこの3カントリーの需要だけ格別に高くて RGI 入り。
他の地域にこれと同格の需要があるかと言われると微妙なので積極的には増えないみたい。

U+E0000 台を使う仕様が他にないので、これも「U+E0000 台の文字を見かけたら特殊処理」ってやるのが楽。

## RGI_Emoji_Modifier_Sequence

Extended_Pictographic Extend 構造になっているもの。
U+FE0F (異体字セレクター16)付きのものは Basic_Emoji 扱いになっているので、実際この分類で並んでいるのは肌色選択のみ。

必ず「人系の絵文字 + U+1F3FB～1F3FF」になってる。
「この絵文字も肌色選択できないとまずい」みたいな絵文字は割と増えるので、
このパターンの絵文字シーケンスは結構頻繁に追加される。

ただ、さすがに以下のような制限あり。

- 「特定の肌色だけない」みたいな歯抜けは逆にありえない
  - 「この絵文字は肌色違いのバリエーションを持っている」っていう情報だけあれば機械的に neutral + 5色の絵文字が作れる
- 他に「性別配慮」とか「髪型配慮」みたいな仕様との組み合わせがあるものの、「肌色が前」と決まってる
  - 2文字目(Basic_Emoji の直後)にしか出てこない

Unicode 13.1 時点で 590 文字あって、今後もどんどん増えると思われるものの、
「色違いを除けば Basic_Emoji 判定と同じ」で済むのでこれ用のテーブルは不要。

## RGI_Emoji_ZWJ_Sequence

複数の絵文字を ZWJ で1文字につなぐ仕様。

元々は「カップル絵文字に男女の組み合わせしかないのは問題がある」みたいな流れで、
💑 (couple with heart, U+1F491 の1符号点)に対して 👨‍❤️‍👨 (couple with heart: man, man) を 👨(man, U+1F468)、👩 (woman, U+1F469) と ❤ (heavy black heart, U+2764) を ZWJ でつないで代替することになったのが発端。

その後、「対応していなければ ZWJ を除いた複数の絵文字で表示させとけばいい」ってのが勝手がよかったので、いろんなパターンの ZWJ 絵文字シーケンスが増えてる。
Unicode 13.1 では以下のようなものあり。

- 家族・恋人系(人種 + ジェンダーの組み合わせ配慮) 312文字
- 元々あった絵文字への人種・ジェンダー配慮追加 572文字
- 職業系(人 + 他の絵文字で表現) 360文字
- 髪の毛(赤毛、ハゲ)配慮追加 72文字
- その他、犬とか猫のとかの亜種 13文字

結構な文字数があるものの、人系の絵文字は「肌色選択のせいで6倍の量」になっているので、それを除外した6分の1のテーブルで大丈夫。

恋人系(Unicode 13.0 では 👫👬👭 (man and women/men/women holding hands)のみ、Unicode 13.1 で 💏 (kiss) と 💑 (couple with heart) の肌色バリエーション追加)はさらに、肌色の組み合わせが5×5パターンあり。

さすがにその他の家族系絵文字(特に3人・4人家族)は RGI には入ってない。

## その他

RGI はほんとに「実装を推奨されている」というだけで、他の文字を実装してもいいし、意図的に推奨に沿わない選択肢もあり。

例えば Windows には追加絵文字も意図的に表示しない絵文字もある。

- 家族の構成に肌色選択を組み込める。(肌色5色×ジェンダー)^家族4人分 で結構えげつない数の絵文字をレンダリングできる
- [自社キャラの特殊絵文字](https://gigazine.net/news/20160413-emoji-ninja-cat/)を持ってる
- 国旗は絶対に表示しない。国コードのアルファベット2文字で表示される
